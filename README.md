# MY1 Bot Platform

منصة تداول متكاملة مبنية على Node.js تحول البوت السابق إلى نظام متعدد المستخدمين مع قاعدة بيانات MySQL، واجهة هبوط عصرية، وإدارة كاملة للقواعد والأوامر.

## أهم المزايا

- **نظام حسابات**: تسجيل مستخدمين، تسجيل دخول JWT، وتخزين كلمات المرور مشفرة بـ bcrypt.
- **ربط Binance لكل مستخدم**: حفظ مفاتيح API الخاصة بكل مستخدم بشكل مشفر داخل قاعدة البيانات.
- **قواعد تداول في MySQL**: بدلاً من ملفات JSON يتم حفظ القواعد في جدول rules مع إمكانية التفعيل، الإيقاف والحذف.
- **مولد قواعد بالذكاء الاصطناعي**: استدعاء ChatGPT لإنشاء قواعد تداول يتم حفظها وتفعيلها مباشرة.
- **محرك تداول متعدد المستخدمين**: حلقة تنفيذ تقرأ قواعد كل مستخدم وتتعامل مع حساب Binance الخاص به.
- **واجهة أمامية حديثة**: صفحة هبوط متجاوبة تعرض المزايا وبطاقات التسجيل، ولوحة تحكم كاملة بعد الدخول.

## المتطلبات

- Node.js 18 أو أحدث.
- قاعدة بيانات MySQL 8 (أو MariaDB متوافقة).
- حساب Binance مع صلاحيات Spot Trade + Read فقط (مُفضل تفعيل IP whitelist).

## الإعداد السريع

```bash
git clone https://github.com/<YOUR_USERNAME>/my1-app.git
cd my1-app
cp .env.example .env
npm install
```

قم بتعديل ملف `.env` بما يناسب بيئتك (راجع متغيرات البيئة بالأسفل)، ثم شغل الخادم:

```bash
npm start
```

> **ملاحظة**: تأكد من إنشاء قاعدة البيانات المحددة في `DB_NAME` قبل تشغيل الخادم (مثلاً `CREATE DATABASE mybot CHARACTER SET utf8mb4;`).

## متغيرات البيئة الأساسية

| المتغير | الوصف |
|---------|-------|
| `PORT` | منفذ الخادم (افتراضي 8080). |
| `DB_HOST` | عنوان خادم MySQL (افتراضي `localhost`). |
| `DB_PORT` | منفذ MySQL (افتراضي `3306`). |
| `DB_USER` | اسم مستخدم قاعدة البيانات. |
| `DB_PASSWORD` | كلمة مرور قاعدة البيانات. |
| `DB_NAME` | اسم قاعدة البيانات التي تحتوي على الجداول. |
| `JWT_SECRET` | سر توقيع رموز الدخول (يجب تغييره في البيئة الإنتاجية). |
| `CREDENTIALS_SECRET` | مفتاح تشفير مفاتيح Binance (إذا لم يحدد يتم استخدام `JWT_SECRET`). |
| `ALLOWED_ORIGINS` | قائمة عناوين مسموح بها للـ CORS مفصولة بفواصل. |
| `OPENAI_API_KEY` | مفتاح واجهة OpenAI لتوليد قواعد الذكاء الاصطناعي. |
| `OPENAI_MODEL` | اسم نموذج OpenAI الافتراضي (افتراضي `gpt-4o-mini`). |
| `BINANCE_BASE` | عنوان واجهة Binance (افتراضي `https://api.binance.com`). |
| `MAKER_ONLY` | هل يتم استخدام أوامر LIMIT_MAKER بشكل افتراضي (افتراضي `true`). |
| `APP_BASE_URL` | العنوان الأساسي المستخدم لإنشاء روابط الواجهة وإشعارات الدفع (افتراضي `http://localhost:8080`). |
| `FRONTEND_URL` | عنوان بديل للواجهة الأمامية في حال نشرها على نطاق مختلف (اختياري). |
| `PUBLIC_URL` | عنوان عام إضافي تستخدمه بعض الروابط أو رسائل البريد (اختياري). |
| `STRIPE_SECRET_KEY` | مفتاح Stripe السري لتفعيل بوابة الدفع Stripe. |
| `STRIPE_WEBHOOK_SECRET` | توقيع Webhook القادم من Stripe للتحقق من الإشعارات. |
| `CRYPTOMUS_MERCHANT_ID` | معرف التاجر داخل بوابة Cryptomus. |
| `CRYPTOMUS_PAYMENT_KEY` | مفتاح الدفع/‏API الخاص ببوابة Cryptomus. |
| `CRYPTOMUS_SUCCESS_URL` | رابط النجاح الذي يتم إعادة التوجيه إليه بعد الدفع عبر Cryptomus. |
| `CRYPTOMUS_CANCEL_URL` | رابط الإلغاء أو الفشل لعمليات Cryptomus. |

## بنية قاعدة البيانات

يتم إنشاء الجداول تلقائياً عند تشغيل الخادم:

- `users`: تخزين بيانات المستخدمين وكلمات المرور المشفرة.
- `user_api_keys`: تخزين مفاتيح Binance لكل مستخدم بعد تشفيرها باستخدام AES-256-GCM.
- `rules`: حفظ القواعد اليدوية وقواعد الذكاء الاصطناعي مع حالة التفعيل والميزانية.

## الواجهة الأمامية

- صفحة هبوط تعرف بالمنصة مع بطاقات المزايا.
- نموذج موحد لتسجيل الدخول أو إنشاء حساب جديد.
- لوحة تحكم بعد الدخول تتضمن:
  - حفظ/إزالة مفاتيح Binance.
  - إنشاء قواعد يدوية.
  - توليد قواعد عبر الذكاء الاصطناعي.
  - جداول للقواعد اليدوية، قواعد الذكاء الاصطناعي، والأوامر المفتوحة.

## المحرك الخلفي

ملف `strategy.js` يقوم بتشغيل حلقة لكل مستخدم يمتلك مفاتيح مفعلة، ويطبق نفس منطق الشراء عند الهبوط/جني الأرباح مع احترام فلاتر Binance. يتم إنشاء عميل Binance منفصل لكل مستخدم باستخدام مفاتيحه الخاصة.

## نصائح أمنية

- استخدم مفاتيح Binance بصلاحيات القراءة والتداول فقط مع تفعيل IP whitelist.
- احرص على تغيير `JWT_SECRET` و `CREDENTIALS_SECRET` في بيئة الإنتاج.
- لا تقم بمشاركة ملف `.env` أو مفاتيحك داخل المستودع.
- راقب سجلات الخادم لأي أخطاء أو محاولات وصول غير مصرح بها.

## تشغيل في الإنتاج

يوصى باستخدام مدير عمليات مثل [PM2](https://pm2.keymetrics.io/):

```bash
pm2 start server.js --name my1
pm2 save
```

مع إعداد Proxy عكسي (Apache/Nginx) لتوجيه الطلبات إلى المنفذ الداخلي.

## رخصة

الاستخدام شخصي وخاص. لا يسمح بإعادة النشر أو التوزيع دون إذن مسبق.
